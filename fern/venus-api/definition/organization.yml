# yaml-language-server: $schema=https://raw.githubusercontent.com/fern-api/fern/main/fern.schema.json

imports:
  commons: commons.yml
types:

  Organization:
    properties:
      organizationId: commons.OrganizationId
      artifactReadRequiresToken: boolean

  UserReference:
    union:
      userId:
        type: commons.UserId
        key: userId
      emailAddress:
        type: string
        key: emailAddress

services:
  http:
    OrganizationService:
      auth: false # TODO make true
      base-path: /organizations
      endpoints:
        create:
          method: POST
          path: /create
          request:
            name: CreateOrganizationRequest
            body:
              properties:
                organizationId: commons.OrganizationId
                artifactReadRequiresToken:
                  type: optional<boolean>
                  docs: Defaults to False
          errors:
            - commons.UnauthorizedError
            - OrganizationAlreadyExistsError

        update:
          method: POST
          path: /{orgId}/update
          path-parameters:
            orgId: commons.OrganizationId
          request:
            name: UpdateOrganizationRequest
            body:
              properties:
                artifactReadRequiresToken: boolean
          errors:
            - commons.UnauthorizedError

        get:
          method: GET
          path: /{orgId}
          path-parameters:
            orgId: commons.OrganizationId
          response: Organization
          errors:
            - commons.UnauthorizedError

        getMyOrganizationFromScopedToken:
          method: POST
          path: /myself
          docs: Returns the org for a scoped token. The token is limited to one
            organization.
          auth: true
          response: Organization
          errors:
            - commons.UnauthorizedError
        # addMember:
        #   method: POST
        #   path: /add-members
        #   request: UserReference
        #   errors:
        #     - commons.UnauthorizedError
        #     - commons.UserIdDoesNotExistError

errors:
  OrganizationAlreadyExistsError:
    status-code: 409
